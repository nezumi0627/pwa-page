<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>PWA判定</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/pwa-page/manifest.json">
</head>
<body>
  <h1>PWA 判定結果</h1>
  <p id="https">HTTPS: 判定中</p>
  <p id="manifest">Manifest: 判定中</p>
  <p id="sw">Service Worker: 判定中</p>
  <p id="result">全体条件: 判定中</p>
  <p id="isPwa">PWA成立: 判定中</p>
  <p id="displayMode">現在の表示モード: 判定中</p>

  <script>
    const httpsOK = location.protocol === 'https:' || location.hostname === 'localhost';
    const manifestOK = !!document.querySelector('link[rel="manifest"]');
    const swOK = 'serviceWorker' in navigator;

    document.getElementById('https').textContent = 'HTTPS: ' + (httpsOK ? '✅ OK' : '❌ NG');
    document.getElementById('manifest').textContent = 'Manifest: ' + (manifestOK ? '✅ OK' : '❌ NG');
    document.getElementById('sw').textContent = 'Service Worker: ' + (swOK ? '✅ OK' : '❌ NG');

    const allOK = httpsOK && manifestOK && swOK;
    document.getElementById('result').textContent = '全体条件: ' + (allOK ? '✅ 条件を満たしています' : '❌ 不完全です');

    // Service Worker 登録
    if (swOK) {
      navigator.serviceWorker.register('/pwa-page/sw.js')
        .then(() => {
          document.getElementById('isPwa').textContent = 'PWA成立: ✅ Yes（SW登録成功）';
        })
        .catch(() => {
          document.getElementById('isPwa').textContent = 'PWA成立: ❌ No（SW登録失敗）';
        });
    } else {
      document.getElementById('isPwa').textContent = 'PWA成立: ❌ No（SW未対応）';
    }

    // PWAとして開かれているか判定
    function getDisplayMode() {
      let mode = 'browser（通常のタブ）';

      if (window.matchMedia('(display-mode: standalone)').matches) {
        mode = 'standalone（PWAとしてインストール起動）';
      } else if (navigator.standalone) {
        mode = 'standalone（iOS Safari）';
      }

      document.getElementById('displayMode').textContent = '現在の表示モード: ✅ ' + mode;
    }

    // 読み込み時にチェック
    window.addEventListener('load', getDisplayMode);
  </script>
</body>
</html>
